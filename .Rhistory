library(ellmer);
library(tidyverse);
library(furrr); # for parallel map
library(kableExtra);
library(jsonlite)
library(dplyr)
library(readr)
library(httr2)
library(purrr)
library(tibble)
library(stringr)
ctg_studies <- read_csv("Data/ctg-studies.csv")
cancer <- read_csv("Data/cancer.csv")
ctg_clean <- read_csv("Data/ctg_clean.csv")
glimpse(ctg_clean)
ctg_clean <- ctg_clean %>%
mutate(
# keep only the first 7 characters if date has a day (YYYY-MM-DD → YYYY-MM)
Start_Date_clean = str_sub(`Start Date`, 1, 7),
# if format is just YYYY, append "-01" to make YYYY-01
Start_Date_clean = if_else(
str_detect(Start_Date_clean, "^\\d{4}$"),
paste0(Start_Date_clean, "-01"),
Start_Date_clean
),
# convert to proper Date type (first day of the month)
Start_Date_clean = ym(Start_Date_clean)
)
View(ctg_clean)
ctg_clean <- ctg_clean %>%
mutate(
# keep only the first 7 characters if date has a day (YYYY-MM-DD → YYYY-MM)
Start_Date_clean = str_sub(`Start Date`, 1, 7),
# if format is just YYYY, append "-01" to make YYYY-01
Start_Date_clean = if_else(
str_detect(Start_Date_clean, "^\\d{4}$"),
paste0(Start_Date_clean, "-01"),
Start_Date_clean
),
# convert to proper Date type (first day of the month)
Start_Date_clean = ym(Start_Date_clean)
) %>%
mutate(
Intervention_clean = Interventions %>%
# extract all uppercase words before colon (like DRUG, RADIATION, etc.)
str_extract_all("\\b[A-Z]+(?=:)") %>%
# flatten and remove duplicates within each row
lapply(unique) %>%
# collapse back into a single string, separated by |
sapply(function(x) paste(x, collapse = "|"))
)
View(ctg_clean)
write_csv(ctg_clean, "Data/ctg_clean.csv")
