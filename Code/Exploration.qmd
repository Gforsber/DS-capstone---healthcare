---
title: "Data exploration"
format: html
editor: visual
---

#load packages

```{r}
library(readr)
library(dplyr)
library(ggplot2)
library(forcats)
library(scales)
library(treemapify)
```

#load in IHME data

```{r}
totalcancer <- read_csv("Data/IHMEtotalcancer/IHME-GBD_2021_DATA-eae6be09-1.csv")
cancerdaly <- read_csv("Data/IHME-Cancer-Daly's/IHME-GBD_2021_DATA-12473b24-1.csv")

```

#Exploration: Cancer types for total deaths

```{r}
total_by_year <- totalcancer %>%
  filter(metric == "Number", measure == "Deaths") %>%  
  group_by(year, cause) %>%
  summarise(total = sum(val, na.rm = TRUE), .groups = "drop")

top_causes <- total_by_year %>%
  group_by(cause) %>%
  summarise(overall_total = sum(total, na.rm = TRUE), .groups = "drop") %>%
  slice_max(overall_total, n = 10) %>%   
  pull(cause)

top_cancers_only <- total_by_year %>%
  filter(cause %in% top_causes)

ggplot(top_cancers_only, aes(x = year, y = total, color = cause)) +
  geom_line(size = 1) +
  labs(title = "Cancer Types by Total Deaths Over Time (Top 10)",
       x = "Year", y = "Total Deaths", color = "Cancer Type") +
    scale_y_continuous(labels = comma) +
  theme_minimal()
```

#Exploration: Most recent year (2021) global cancer deaths

```{r}
latest_year <- max(totalcancer$year, na.rm = TRUE)

global_latest <- totalcancer %>%
  filter(location == "Global", metric == "Number", measure == "Deaths", age == "All ages", sex == "Both", year == latest_year) %>%
  group_by(cause) %>%
  summarise(total_deaths = sum(val, na.rm = TRUE), .groups = "drop") %>%
  arrange(desc(total_deaths)) %>%
  slice_head(n = 15)

ggplot(global_latest, aes(x = reorder(cause, total_deaths), y = total_deaths)) +
  geom_col(fill = "blue") +
  coord_flip() +
  labs(title = paste("Top 15 Global Cancer Deaths in", latest_year), x = "Cancer Type", y = "Total Deaths") +
  theme_minimal()
```

#Exploration: Total cancer deaths by year

```{r}
global_trend <- totalcancer %>%
  filter(location == "Global", metric == "Number", measure == "Deaths", age == "All ages", sex == "Both") %>%
  group_by(year) %>%
  summarise(total_deaths = sum(val, na.rm = TRUE), .groups = "drop")

ggplot(global_trend, aes(x = year, y = total_deaths)) +
  geom_line(size = 1.2, color = "red") +
  geom_point(color = "darkred") +
  labs(title = "Total Global Cancer Deaths Over Time", x = "Year", y = "Total Deaths") +
  theme_minimal()
```

#Exploration: Top cancer by daly in America

```{r}
top_dalys <- cancerdaly %>%
  filter(location_name == "America",
         measure_name == "DALYs (Disability-Adjusted Life Years)",
         metric_name == "Number",
         sex_name == "Both",
         age_name == "All ages") %>%
  group_by(year, cause_name) %>%
  summarise(total_dalys = sum(val, na.rm = TRUE), .groups = "drop") %>%
  filter(year == max(year)) %>%
  slice_max(order_by = total_dalys, n = 10)

ggplot(top_dalys, aes(x = reorder(cause_name, total_dalys), y = total_dalys)) +
  geom_col(fill = "blue") +
  coord_flip() +
  labs(title = "Top 10 Cancers by DALYs in America (Most Recent Year)",
       x = "Cancer Type", y = "Total DALYs") +
  theme_minimal()
```

#Exploration:

```{r}
rate_dalys_trend <- cancerdaly %>%
  filter(location_name == "America",
         measure_name == "DALYs (Disability-Adjusted Life Years)",
         metric_name == "Rate", #100,000?
         sex_name == "Both",
         age_name == "All ages",
         cause_name != "Neoplasms") %>%
  group_by(year) %>%
  summarise(avg_daly_rate = mean(val, na.rm = TRUE), .groups = "drop")

ggplot(rate_dalys_trend, aes(x = year, y = avg_daly_rate)) +
  geom_line(color = "darkgreen", size = 1.2) +
  geom_point(color = "darkgreen") +
  labs(title = "Cancer DALY Rate per 100k (America)",
       x = "Year", y = "DALYs per 100,000") +
  theme_minimal()
```

```{r}

prop_daly <- cancerdaly %>%
  filter(location_name == "America", 
         measure_name == "DALYs (Disability-Adjusted Life Years)", 
         metric_name == "Number", 
         sex_name == "Both", 
         age_name == "All ages",
         cause_name != "Neoplasms") %>%
  group_by(year, cause_name) %>%
  summarise(total_dalys = sum(val), .groups = "drop") %>%
  group_by(year) %>%
  mutate(prop = total_dalys / sum(total_dalys)) %>%
  ungroup()

top_causes <- prop_daly %>%
  filter(year == max(year)) %>%
  slice_max(prop, n = 5) %>%
  pull(cause_name)

prop_filtered <- prop_daly %>% filter(cause_name %in% top_causes)

ggplot(prop_filtered, aes(x = year, y = prop, color = cause_name)) +
  geom_line(linewidth = 1.2) +
  labs(title = "Proportion of DALY Burden by Cancer Type (Top 5, America)",
       x = "Year", y = "Proportion of Total DALYs", color = "Cancer Type") +
  theme_minimal()


```

#Less smoking around the world, aging population resulting in other types of cancer

#tree map

```{r}
top10_dalys <- cancerdaly %>%
  filter(location_name == "America",
         measure_name == "DALYs (Disability-Adjusted Life Years)",
         metric_name == "Number",
         sex_name == "Both",
         age_name == "All ages",
         cause_name != "Neoplasms", 
         year == 2021) %>%
  group_by(year, cause_name) %>%
  summarise(total_dalys = sum(val, na.rm = TRUE), .groups = "drop") %>%
  filter(year == max(year)) %>%
  slice_max(total_dalys, n = 10) %>%
  arrange(desc(total_dalys))

latest_year <- unique(top10_dalys$year)

ggplot(top10_dalys,
       aes(area = total_dalys,
           fill = total_dalys,
           label = paste0(cause_name, "\n", comma(round(total_dalys))))) +
  geom_treemap(color = "white") +
  geom_treemap_text(reflow = TRUE, place = "centre", grow = TRUE) +
  scale_fill_viridis_c(
    name = "Total DALYs",
    labels = label_number(scale_cut = cut_short_scale())
  ) +
  labs(
    title = paste("Top 10 Cancer Types by DALYs (America,", latest_year, ")"),
    subtitle = "DALYs = Disability-Adjusted Life Years\nBox size reflects total DALY burden"
  ) +
  theme_minimal()
```
